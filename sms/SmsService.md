# Исходные допущения:
Сервис смс-рассылки имеет общие справочники с ПО Займ или мастер-данными (на данный момент мастер-данными будут выступать данные из ПО Займ)
Таковыми данными будут:
1. справочник сотрудников (keyW, ФИО)  
 >> **Комментарий 1:**  Отсылая к нашему обсуждению сервиса смс, мы условились, что вся информация о пользователе вы храните в ПО займ. ***У себя мы храним только идентификатор в заголовке сообщения / рассылки.*** 

2. справочник шаблонов рассылок (keyS, Название рассылки) 
>> **Комментарий 2:** В базе смс рассылок будут храниться список о всех входящих заголовках. 
>> 1. Словарь шаблонов будет ***дублировать его***.
>> 2. Тем самым мы отвязываемся от ***дополнительной синхронизации и связей с ПО займ***

3. справочник смс-провайдеров  
>> **Комментарий 3:** Мы договрились, что всю информацию об СМС провайдерах храниться на стороне  ***Сервиса СМС*** и ***ПО Займ забирает ее по средствам Http запроса***.
 
4. справочник типов смс (например, тип: Авторизация, АСП, Информационное сообщение, Взыскание, Информация о просрочке и др.) - 

### Внутренние справочники:
1. справочник смс-операторов (пока не нужен, не используем)
2. справочник принадлежности диапазонов DEF-кодов к сотовым операторам


***

# Я как пользователь сервисом должен иметь возможность:

1. Отправить смс одну или группу. У группы смс одинаковые настройки и шаблон текста смс, но разные телефоны и значения для слов-шаблонов, которые подставляются в шаблон текста.
2. Указать тип смс (например, тип: Авторизация, АСП, Информационное сообщение, Взыскание, Информация о просрочке и др.)
3. Указать через какого провайдера надо отправить смс (передача значения -1 значит, что берутся настройки из модуля) 

 >> **Комментарий 4:** *В таком случае, **чтобы сформировать единичную смс или смс рассылку
 >> необходимо запросить у Сервиса СМС возможность юр. лица, от имени кого 
 >> инициализируется рассылка, пользоваться запрашиваемым Провайдером СМС**. 
 >> Т.е. ***Http запрос к REST API Сервиса СМС*!!!***  

4. Указать от имени какого юр.лица отправить смс
5. Указать время, не ранее которого смс должна быть отправлена
6. **Указать время, не позднее которого должна быть отправлена смс.
7. Указать приоритет отправки смс
8. Указать потребность в использовании ротации провайдеров (Ротация - при отправке смс одного и того же типа на один и тот же номер за определенный промежуток времени смс-провайдер должен смениться с текущего на последующий, который указан в настройках модуля смс-рассылки)
9.  Указать, что требуется соблюдение ФЗ230 (не допускается направленное на возврат просроченной задолженности взаимодействие с должником посредством телеграфных сообщений, текстовых, голосовых и иных сообщений:
10) в рабочие дни в период с 22 до 8 часов и в выходные и нерабочие праздничные дни в период с 20 до 9 часов по местному времени по месту жительства или пребывания должника, известному кредитору и (или) лицу, действующему от его имени и (или) в его интересах;
11) общим числом:
а) более двух раз в сутки;
б) более четырех раз в неделю;
в) более шестнадцати раз в месяц.)
10. Возможность в деталировке указывать дополнительные значения, которые необходимо сохранять в конечном хранилище смс (например, KeyPart, тип контакта (клиент, доп.контакт, сотрудник)).
11. Возможность в заголовке указывать доп.поля, которые необходимо сохранять в конечном хранилище смс (например, keyW - ключ сотрудника, создавшего смс)
12. Вставлять в шаблон текста смс слова-шаблоны, которые перед отправкой должны будут заменяться на значения из таблицы-деталировки
13. ** Передать в специальном поле зашифрованное значение для слова-подстановки "+секрет+".
>> **Комментарий 5:** *Дмитрий, вы можете сказать зачем нужен PlaceHolder ***+Секрет+***? 
>> Если мы реализуем логику ***по вашеq моделе***, то получается, что нам придется ***дважды выполнять одну и ту же операцию***. **Подстановка.** 
>> Как вариант мы можем попробовать реализовать кодирование +секрет+ при отправке отчета*. 




***

# Как SQL сервер я могу пользоваться только таблицами для отправки данных в сервис СМС отправки.

***
Я как администратор модуля должен иметь возможности:
1. Задать для каждой организации, какой из провайдеров должен использоваться по умолчанию
2. Увидеть список заголовков рассылаемых смс, кем они были созданы, какой организации принадлежат, через кого рекомендована отправка, отображать сводные данные состояния смс из деталировки (Всего, В обработке, Успешно, Отказ, Ожидают, Отменены)
3. Увидеть деталировку: CustomField_1 (keyPart), Тест смс, статус смс, значения для слов-подстановок.
4. Выполнить отмену рассылки для заголовка. При этом смс, которые находятся в статусе "Ожидают" должны быть переведены в статус "Отменены".


***

# Модуль должен иметь настройки:
1. Ротация: для провайдера указывается провайдер, который должен будет использоваться при повторной отправке смс того же типа на тот же номер и с тем же шаблоном текста
2. Список провайдеров, с которыми есть интеграция
3. Список юр.лиц и учетные данные провайдеров смс, которые им доступны

***

# Модуль смс-рассылки должен:
1. Перед отправкой преобразовывать шаблон смс в предварительный текст для отправки, заменяя слова-подстановки на соответствующие значения. При этом замены слова-подстановки "+секрет+" не происходит
2. Предварительный текст для отправки должен сохраняться в деталировке
3. При отправке заменять в предварительном тексте слово-подстановки "+секрет+" на его значение из деталировки


***

Нужна информация для формирования UI отчетности.
Требования к отчетности:
1. Обязательно указывать период отчета
2. Если есть доступ, то организацию можно не указывать, и тогда в отчет должны попасть все организации.
3. Если доступа нет, то организация выбирается та, к которой принадлежит сотрудник, использующий сервис.
4. Возможность фильтровать по кастомным полям. Поиск по полному соответствию (равенство).
***

Какие виды отчетов могут быть востребованы?
Отчет должен содержать:
Дату/время отправки, Юр.лицо от кого отправка, Статус доставки, Текст смс, тип смс, номер телефона, CustomField_1 (идентификатор клиента keyPart), CustomField_2 (тип контакта (клиент, доп.контакт, сотрудник)
Фильтры, которые могут применяться:
1. По введенному номеру телефона и организации предоставить список отправленных смс за заданный период. 
2. По значению поля CustomField_1 (идентификатор клиента, keyPart) и  организации предоставить список отправленных смс за заданный период
3. Распределение смс за период по принадлежности к операторам согласно справочника принадлежности диапазонов DEF-кодов к сотовым операторам. Отчет содержит: Юр.лицо, Оператор, Кол-во смс

***

Какие сводные данные по смскам могут понадобиться?
1. Количество созданных смс за последние 60 минут с группировкой по организациям/провайдерам и с разбивкой на: Всего, В обработке, Успешно, Отказ, Ожидают
2. В сводных данных отображать все организации только если есть доступ.
